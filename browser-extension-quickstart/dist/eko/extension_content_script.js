function type(e){let t,n,o=e.text,l=!1;if(o.endsWith("\\n")?(l=!0,o=o.substring(0,o.length-2)):o.endsWith("\n")&&(l=!0,o=o.substring(0,o.length-1)),null!=e.highlightIndex)t=window.get_highlight_element(e.highlightIndex);else if(e.xpath){let n=e.xpath;t=document.evaluate(n,document,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue}else{let n=e.coordinate;t=document.elementFromPoint(n[0],n[1])||document.activeElement}if(!t)return!1;if(n="INPUT"==t.tagName||"TEXTAREA"==t.tagName||0==t.childElementCount?t:t.querySelector("input")||t.querySelector("textarea")||t,n.focus&&n.focus(),o)n.value+=o;else{if(""==n.value)return!0;n.value=""}let s=n.dispatchEvent(new Event("input",{bubbles:!0}));return l&&["keydown","keypress","keyup"].forEach((e=>{const t=new KeyboardEvent(e,{key:"Enter",code:"Enter",keyCode:13,bubbles:!0,cancelable:!0});n.dispatchEvent(t)})),console.log("type",n,e,s),!0}function mouse_move(e){let t=e.coordinate,n=t[0],o=t[1];const l=new MouseEvent("mousemove",{view:window,bubbles:!0,cancelable:!0,screenX:n,screenY:o,clientX:n,clientY:o});let s=document.body.dispatchEvent(l);return console.log("mouse_move",document.body,e,s),!0}function simulateMouseEvent(e,t,n){let o;if(null!=e.highlightIndex)o=window.get_highlight_element(e.highlightIndex);else if(e.xpath){let t=e.xpath;o=document.evaluate(t,document,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue}else{let t=e.coordinate;o=document.elementFromPoint(t[0],t[1])||document.body}if(!o)return!1;for(let l=0;l<t.length;l++){const s=new MouseEvent(t[l],{view:window,bubbles:!0,cancelable:!0,clientX:void 0,clientY:void 0,button:n});let i=o.dispatchEvent(s);console.log("simulateMouse",o,{...e,eventTypes:t,button:n},i)}return!0}function scroll_to(e){if(null!=e.highlightIndex){let t=window.get_highlight_element(e.highlightIndex);if(!t)return!1;t.scrollIntoView({behavior:"smooth"})}else if(e.xpath){let t=e.xpath,n=document.evaluate(t,document,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue;if(!n)return!1;n.scrollIntoView({behavior:"smooth"})}else{const t=e.to_coordinate;window.scrollTo({left:t[0],top:t[1],behavior:"smooth"})}return console.log("scroll_to",e),!0}function get_dropdown_options(e){let t;return null!=e.highlightIndex?t=window.get_highlight_element(e.highlightIndex):e.xpath&&(t=document.evaluate(e.xpath,document,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue),t?{options:Array.from(t.options).map((e=>({index:e.index,text:e.text.trim(),value:e.value}))),id:t.id,name:t.name}:null}function select_dropdown_option(e){let t;if(null!=e.highlightIndex?t=window.get_highlight_element(e.highlightIndex):e.xpath&&(t=document.evaluate(e.xpath,document,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue),!t||"SELECT"!==t.tagName.toUpperCase())return{success:!1,error:"Select not found or invalid element type"};const n=Array.from(t.options).find((t=>t.text.trim()===e.text));return n?(t.value=n.value,t.dispatchEvent(new Event("change")),{success:!0,selectedValue:n.value,selectedText:n.text.trim()}):{success:!1,error:"Option not found",availableOptions:Array.from(t.options).map((e=>e.text.trim()))}}function request_user_help(e,t,n){const o="eko-request-user-help";if(document.getElementById(o))return;const l=document.createElement("div");l.id=o,l.style.cssText="\n    position: fixed;\n    top: 5px;\n    left: 18px;\n    z-index: 9999;\n    background-color: #FEF0ED;\n    color: white;\n    padding: 16px;\n    border-radius: 12px;\n    border: 1px solid #FBB8A5;\n    font-family: Arial, sans-serif;\n    width: 350px;\n    display: flex;\n    flex-direction: row;\n    gap: 10px;\n    cursor: move;\n    user-select: none;\n  ";let s=!1,i=0,r=0,c=0,u=0;l.addEventListener("mousedown",(e=>{s=!0,c=e.clientX-i,u=e.clientY-r,e.preventDefault()})),document.addEventListener("mousemove",(e=>{if(!s)return;const t=e.clientX-c,n=e.clientY-u;i=t,r=n,l.style.transform=`translate(${i}px, ${r}px)`})),document.addEventListener("mouseup",(()=>{s=!1}));const a=document.createElement("div");a.style.cssText="\n    width: 28px;\n    height: 28px;\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    border-radius: 99px;\n    background: #FDCCCC;\n    justify-content: center;\n  ",a.innerHTML="";const d=document.createElement("div");d.style.cssText="\n    flex: 1;\n    display: flex;\n    flex-direction: column;\n  ";const m=document.createElement("div");m.style.cssText="\n    font-size: 16px;\n    font-weight: 700;\n    line-height: 22px;\n    color: #DD342D;\n    text-align: left;\n  ",m.innerText={login_required:"Login Required",captcha:"Captcha Detected",blocked:"Blocked",other:"Error",rate_limited:"Rate Limited"}[t]||t;const p=document.createElement("div");p.style.cssText="\n    font-size: 16px;\n    font-weight: 400;\n    line-height: 22px;\n    color: #DD342D;\n    text-align: left;\n  ",p.innerText=n+"\nWhen you resolve the issue, click the button below.";const h=document.createElement("div");h.style.cssText="\n    margin-top: 16px;\n    display: flex;\n    flex-direction: row-reverse;\n    justify-content: flex-start;\n    align-items: center;\n  ";const g=document.createElement("div");g.innerText="Resolved",g.style.cssText="\n    border-radius: 8px;\n    background: #DD342D;\n    color: white;\n    padding: 10px;\n    border: none;\n    cursor: pointer;\n  ",g.onclick=()=>{chrome.runtime.sendMessage({type:"issue_resolved",task_id:e,failure_type:t},(()=>{l.remove()}))},h.appendChild(g),d.appendChild(m),d.appendChild(p),d.appendChild(h),l.appendChild(a),l.appendChild(d),document.body.appendChild(l)}window.eko||(window.eko={lastMouseX:0,lastMouseY:0}),eko.sub=function(e,t){eko.subListeners||(eko.subListeners={}),e&&t&&(eko.subListeners[e]=t)},document.addEventListener("mousemove",(e=>{eko.lastMouseX=e.clientX,eko.lastMouseY=e.clientY})),chrome.runtime.onMessage.addListener((function(e,t,n){return(async()=>{try{switch(e.type){case"eko:message":{let t=null;if(eko.subListeners&&eko.subListeners[e.event])try{t=await eko.subListeners[e.event](e.params)}catch(e){console.log(e)}n(t);break}case"page:getDetailLinks":{let t=await eko.getDetailLinks(e.search);n(t);break}case"page:getContent":{let t=await eko.getContent(e.search);n(t);break}case"request_user_help":request_user_help(e.task_id,e.failure_type,e.failure_message),n(!0);break;case"computer:type":n(type(e));break;case"computer:mouse_move":n(mouse_move(e));break;case"computer:left_click":n(simulateMouseEvent(e,["mousedown","mouseup","click"],0));break;case"computer:right_click":n(simulateMouseEvent(e,["mousedown","mouseup","contextmenu"],2));break;case"computer:double_click":n(simulateMouseEvent(e,["mousedown","mouseup","click","mousedown","mouseup","click","dblclick"],0));break;case"computer:scroll_to":n(scroll_to(e));break;case"computer:cursor_position":n({coordinate:[eko.lastMouseX,eko.lastMouseY]});break;case"computer:get_dropdown_options":n(get_dropdown_options(e));break;case"computer:select_dropdown_option":n(select_dropdown_option(e))}}catch(e){console.log("onMessage error",e),n(!1)}})(),!0}));